# winh

## Goal

- Windows11 で動く
    - written in Rust
    - this can be compiled on any platform (e.g. WSL)
    - 単一の exe ファイルが生成される (without installer)
- 単一画面を持つGUI
- スタートボタンが大きくある
    - 押すとボタンは停止ボタンに変わる
    - Windows規定の音声入力から音声入力を受け付ける
    - 2秒間音声入力がなければ停止
        - そこまでの音声入力を mp3 で一時的に保存
        - openai/gpt-4o-transcribe に投げる
        - テキストが返ってくる
            - テキストをGUIに表示
            - さらに、クリップボードにコピー
- 簡易設定
    - 設定画面をモーダルで開く
        - 無音検出の秒数設定 (デフォルト2秒)
        - OpenAI API Key の設定
        - openai model の設定 (デフォルト gpt-4o-transcribe)
    - 以上の設定はローカルに保存

## TODO

### Phase 1: 基本セットアップ ✅ 完了
- [x] GUIフレームワークの選定と導入（egui 0.29を採用）
- [x] 基本的なウィンドウとスタート/停止ボタンのUI実装
- [x] ボタン状態の切り替え機能（⏺ Start / ⏹ Stop）
- [x] Makefileの作成とクロスコンパイル設定
- [x] mingw-w64依存関係の設定
- [x] README.mdの作成

### Phase 2: 音声入力機能 ✅ 完了
- [x] Windows音声入力APIの調査と選定（cpal 0.15を採用）
- [x] 音声入力のキャプチャ機能実装（AudioRecorderモジュール）
- [x] 音声データのバッファリング（Arc<Mutex<Vec<f32>>>で実装）
- [x] GUIとの統合（リアルタイム録音情報表示）

### Phase 3: 音声処理 ✅ 完了
- [x] 無音検出ロジックの実装（振幅しきい値ベース、デフォルト0.01）
- [x] 音声データをWAV形式で一時保存する機能（houndクレート使用）
- [x] 一時ファイルの管理（tempfileクレート使用、自動命名）
- [x] 自動無音検出による録音停止機能（デフォルト2秒）
- [x] リアルタイム無音時間表示

### Phase 4: OpenAI API連携
- [ ] HTTP clientの導入（reqwest等）
- [ ] OpenAI Whisper API (gpt-4o-transcribe) への音声ファイル送信機能
- [ ] API レスポンスのパース処理
- [ ] エラーハンドリング（ネットワークエラー、APIエラー等）

### Phase 5: 結果表示とクリップボード
- [ ] 文字起こし結果をGUIに表示
- [ ] クリップボードへのテキストコピー機能（clipboard-win等）

### Phase 6: 設定機能
- [ ] 設定データ構造の定義（無音検出秒数、API Key、モデル名）
- [ ] 設定画面のモーダルUI実装
- [ ] 設定の読み込み・保存機能（JSONまたはTOML形式）
- [ ] 設定ファイルの保存先決定（%APPDATA%等）

### Phase 7: 仕上げ
- [ ] エラー表示UI（API key未設定、ネットワークエラー等）
- [ ] リリースビルドの動作確認
- [ ] Windows11での実機テスト

## 進捗状況

- **Phase 1**: ✅ 完了 (2025-12-17)
  - GUI基盤の構築完了
  - Windows向けビルド環境構築完了
  - 生成物: `winh.exe` (基本UI実装済み)

- **Phase 2**: ✅ 完了 (2025-12-17)
  - cpalを使った音声入力機能実装完了
  - リアルタイム録音＆バッファリング機能
  - 録音時間・サンプル数の表示機能
  - 生成物: `winh.exe` (音声入力機能実装済み)

- **Phase 3**: ✅ 完了 (2025-12-17)
  - 無音検出ロジックの実装完了
  - 自動停止機能（2秒無音で停止）
  - WAV形式での音声保存機能
  - 一時ファイル管理システム
  - 生成物: `winh.exe` (自動録音停止＆保存機能実装済み)

- **Phase 4-7**: 未着手
  - 次のステップ: OpenAI Whisper API連携

## @CLAUDE

- このファイルは適宜読み直してチェックして
- あなたも、このファイルを編集できる
- Phase完了時は進捗状況セクションを更新すること
